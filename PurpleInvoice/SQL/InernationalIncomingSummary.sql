use purple; select c.partnername as `ANS`,sum(CallCount) as `Total Call Count` ,sum(ActualDuration) as `Total Actual Duration` ,sum(BilledDuration) as 'Total Billed Duration' ,'0.04' as 'Rate' ,(sum(BilledDuration) * 0.04 ) as 'Amount',(sum(BilledDuration) * 0.04*0.15) as 'Vat' ,((sum(BilledDuration) * 0.04*0.15)+(sum(BilledDuration) * 0.04 )) as 'Invoice' from ( select customerid,supplierid, DATE_FORMAT(date(starttime),'%d/%m/%Y') `Date`,Count(*) as CallCount,sum(durationsec)/60 ActualDuration, sum(case when (truncate(durationsec-truncate(durationsec,0),1))>=0 then ceiling(durationsec) else floor(durationsec) end)/60 as RoundedDuration,sum(Duration1)/60 as BilledDuration from purple.cdrloaded where calldirection=3 and starttime>= @startTime and starttime< @endTime group by customerid,supplierid,date(starttime) ) x left join partner c on x.customerid=c.idpartner left join partner s on x.supplierid=s.idpartner group by  c.partnername ;